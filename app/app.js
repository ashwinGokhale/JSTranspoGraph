(function () {"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var p5=_interopDefault(require("p5")),TinyQueue=_interopDefault(require("tinyqueue")),fs=_interopDefault(require("fs")),path=_interopDefault(require("path")),classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Vehicle=function(){function e(t,n,a,s,i){var r=this;classCallCheck(this,e),this.toString=function(){return r.name},this.name=t,this.speedOfTravel=n,this.waitTime=a,this.unitCost=s,this.typeOfCost=i,this.location=void 0}return createClass(e,[{key:"calculateCostOfTravel",value:function(e){switch(this.typeOfCost){case 1:return this.unitCost;case 2:return this.unitCost+2*e;case 3:return this.unitCost/25*e;default:return 0}}}]),e}();Vehicle.vehicleNames=["Aircraft","Bart","Bicycle","Bus","Car","Taxi"];var Graph=function(){function e(){classCallCheck(this,e),this.graph={}}return createClass(e,[{key:"addVertex",value:function(e){this.graph[e.name]=e}},{key:"containsLocation",value:function(e){return void 0!=this.graph[e.name]}},{key:"addEdge",value:function(e,t,n,a){this.containsLocation(e)||this.addVertex(e),this.containsLocation(t)||this.addVertex(t),e.addNeighbor(t,n,a),t.addNeighbor(e,n,a)}},{key:"computePaths",value:function(e){var t=e.currentLoc;Object.values(this.graph).forEach(function(e){e.dist=1/0,e.prev=null}),t.dist=0;var n=new TinyQueue([],function(e,t){return e&&t?e.dist<t.dist?-1:e.dist>t.dist?1:0:0});n.push(t);for(;n.peek();)!function(){var t=n.pop();e.vehiclePreference;t.adjacent.get(vehicles.get(e.vehiclePreference)).forEach(function(e){var a=e.to,s=t.dist+e.weight;s<a.dist&&(n.data.filter(function(e){return e==a}),a.dist=s,a.prev=t,n.push(a))})}()}}]),e}(),getShortestPathTo=function(e){for(var t=[],n=e;null!=n;n=n.prev)t.push(n);return t.reverse(),1==t.length&&t.push(t[0]),t},Edge=function e(t,n,a,s){classCallCheck(this,e),this.from=t,this.to=n,this.weight=a,this.vehicleType=s},path$1=require("path"),Location=function e(t,n,a,s,i,r,o){var c=this;classCallCheck(this,e),this.addNeighbor=function(e,t,n){var a=new Edge(c,e,t,n);c.adjacent.get(n).includes(a)||c.adjacent.get(n).push(a)},this.name=t,this.x=s,this.y=i,this.vehicleTypes=r,this.vehicles=o,this.lat=n,this.lon=a,this.dist=1/0,this.adjacent=new Map,o.forEach(function(e){e&&c.adjacent.set(e,[])})},getDistance=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},getHaversineDistance=function(e,t){var n=e.lat,a=e.lon,s=t.lat,i=t.lon,r=Math.PI/180*n,o=Math.PI/180*s,c=Math.PI/180*(s-n),h=Math.PI/180*(i-a),l=Math.sin(c/2)*Math.sin(c/2)+Math.cos(r)*Math.cos(o)*Math.sin(h/2)*Math.sin(h/2);return.621371*(6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))))},Passenger=function(){function e(t,n,a,s,i){classCallCheck(this,e),this.name=t,this.currentLoc=n,this.dest=a,this.preference=s,this.vehiclePreference=i,this.path=[],this.cost=0}return createClass(e,[{key:"setPath",value:function(e){this.path=e}},{key:"calculateCost",value:function(){for(var e=0,t=0;t<this.path.length-1;t++)e+=getHaversineDistance(this.path[t],this.path[t+1]);return this.cost=vehicles.get(this.vehiclePreference).calculateCostOfTravel(e),this.cost}}]),e}(),g=new Graph,locations=[],passengers=[],vehicles=new Map,loadVehicles=function(){return require(path.join(__dirname,"../src/settings/Vehicles.json")).map(function(e){return vehicles.set(e.type,new Vehicle(e.name,e.speed,e.wait,e.unitCost,e.costType))}),vehicles},loadLocations=function(){return require(path.join(__dirname,"../src/settings/Locations.json")).map(function(e){for(var t=[],n=0;n<e.vehicleTypes.length;n++)e.vehicleTypes[n]?t.push(vehicles.get(Vehicle.vehicleNames[n])):t.push(null);var a=new Location(e.name,e.latitude,e.longitude,e.x,e.y,e.vehicleTypes,t);return locations.push(a),g.addVertex(a),a})},loadPassengers=function(){return require(path.join(__dirname,"../src/settings/People.json")).map(function(e){var t=new Passenger(e.name,g.graph[e.currentLocation],g.graph[e.destination],e.preference,e.vehiclePreference);return passengers.push(t),t})},loadPaths=function(){return require(path.join(__dirname,"../src/settings/Paths.json")).map(function(e){for(var t=g.graph[e.from],n=g.graph[e.to],a=0;a<6;a++)t.vehicleTypes[a]&&n.vehicleTypes[a]&&g.addEdge(t,n,getDistance(t,n),t.vehicles[a]);return[t,n]})},sketch=function(e){var t=void 0,n=void 0,a=void 0,s=[],i=0,r=1,o=20,c=[];e.setup=function(){e.createCanvas(1700,900).parent("root"),t=e.loadImage("../build/icons/Map.PNG"),loadVehicles(),loadLocations(),loadPaths(),loadPassengers(),passengers.forEach(function(e){g.computePaths(e);var t=getShortestPathTo(e.dest);t[0]==t[1]?e.setPath([e.currentLoc,e.currentLoc]):e.setPath(t),console.log(e.name+"'s path using "+e.vehiclePreference+":");var n=e.path.map(function(e){return e.name}).join(", ");console.log(""+n)}),e.background(255),s=passengers[i].path,n=s[0].x,a=s[0].y},e.draw=function(){if(e.image(t,0,0),e.frameRate(30),locations.forEach(function(t){e.fill(255,0,0),e.ellipse(t.x,t.y,20,20),"San Ramon"!=t.name&&"Dublin"!=t.name||(e.fill(0),e.textSize(13),e.text(t.name,t.x-30,t.y-20)),t.vehicles.forEach(function(n){null!=n&&t.adjacent.get(n).forEach(function(n){e.line(t.x,t.y,n.to.x,n.to.y)})})}),n=e.lerp(parseFloat(n),parseFloat(s[r].x),.1),a=e.lerp(parseFloat(a),parseFloat(s[r].y),.1),e.fill(0,175,255),e.ellipse(n,a,25,25),e.fill(0),e.text(passengers[i].name,n-10,a),Math.abs(n-parseFloat(s[r].x))<1||Math.abs(a-parseFloat(s[r].y))<1){var h=!1;r+1==s.length?i+1==passengers.length?(console.log("FINISHED!"),e.fill(60,0,110),e.textSize(20),e.text(passengers[i].name,n-10,a-20),passengers.forEach(function(t){t.path[0]==t.path[1]?e.text("No possible path for "+t.name+" to go from "+t.currentLoc.name+" to "+t.dest.name+" using a %s\n",720,o):e.text(t.name+"'s path: "+t.path.map(function(e){return e.name}).join(", ")+" Using: "+t.vehiclePreference+"   Total Cost: "+t.calculateCost().toLocaleString("en-US",{style:"currency",currency:"USD"})+"\n",720,o),o+=20}),e.noLoop()):(c.push({name:passengers[i].name,x:n-10,y:a-20}),i++,r=1,h=!0):r++,s=passengers[i].path,h&&(n=s[0].x,a=s[0].y)}c.forEach(function(t){e.fill(60,0,110),e.textSize(20),e.text(t.name,t.x,t.y)})},e.mousePressed=function(e){console.log("("+e.x+", "+e.y+")")}};new p5(sketch);

}());
//# sourceMappingURL=app.js.map